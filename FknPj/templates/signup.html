{% extends "base.html" %}
{% load static %}

{% block 'title' %}Sign up - {{ site_name|default:"Fikrin" }}{% endblock 'title' %}

{% block 'style' %}
<link rel="stylesheet" href="{% static 'css/login-styles_v1.css' %}">
{% endblock 'style' %}

{% block 'content' %}
<div class="container">

  <!-- Signup card -->
  <div class="row justify-content-center my-4">
    <div class="col-lg-6 col-md-8 col-11">
      <main class="card shadow-sm">
        <div class="card-body p-4">
          <h2 class="card-title mb-2 text-center">Create your account</h2>
          <p class="text-center text-muted small mb-4">Join Fikrin — it only takes a minute.</p>

          <!-- Django messages -->
          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-{{ message.tags }} alert-dismissible" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          {% endif %}

          <form class="needs-validation" action="" method="post" novalidate>
            {% csrf_token %}

            <!-- Username -->
            <div class="mb-3">
              <label for="id_username" class="form-label">Username</label>
              <input id="id_username" name="username" type="text" class="form-control" placeholder="Choose a username" required minlength="5" aria-describedby="usernameHelp">
              <div id="usernameHelp" class="form-text small">Min 5 characters.</div>
              {% if message_username %}
                <div class="text-danger small mt-1">{{ message_username }}</div>
              {% endif %}
            </div>

            <!-- Password -->
            <div class="mb-3">
              <label for="id_password" class="form-label">Password</label>
              <div class="input-group">
                <input id="id_password" name="password" type="password" class="form-control" placeholder="Create password" required minlength="8" aria-describedby="pwdHelp passwordToggle">
                <button class="btn btn-outline-secondary" type="button" id="passwordToggle" aria-label="Show password"><i class="fas fa-eye"></i></button>
              </div>
              <div id="pwdHelp" class="form-text small">Min 8 characters. Use letters and numbers for a stronger password.</div>
            </div>

            <!-- Confirm password -->
            <div class="mb-3">
              <label for="id_confirm_password" class="form-label">Confirm password</label>
              <input id="id_confirm_password" name="confirm_password" type="password" class="form-control" placeholder="Repeat password" required>
              {% if message_password %}
                <div class="text-danger small mt-1">{{ message_password }}</div>
              {% endif %}
            </div>

            <!-- Mobile number -->
            <div class="mb-3">
              <label for="id_mobile" class="form-label">Mobile number</label>
              <input id="id_mobile" name="mobile_number" type="tel" class="form-control" placeholder="e.g. +919876543210" pattern="^\+?\d{7,15}$" required aria-describedby="mobileHelp">
              <!-- <div id="mobileHelp" class="form-text small">Include country code. Digits only, 7–15 characters.</div> -->
              {% if message_mbnumber %}
                <div class="text-danger small mt-1">{{ message_mbnumber }}</div>
              {% endif %}
            </div>

            <!-- Server-side errors (aria-live) -->
            <div class="mb-3" aria-live="polite" id="formErrors">
              {% if error_message %}
                <div class="text-danger small">{{ error_message }}</div>
              {% endif %}
            </div>

				<!-- Terms text (no checkbox) -->
				<p class="text-muted small mb-3">
				By signing up, you agree to our 
				<a href="{% url 'Authentication:terms' %}" class="text-decoration-none fw-semibold">Terms & Conditions</a>.
				</p>

				<!-- Submit -->
				<div class="d-grid gap-2">
				<button type="submit" class="btn btn-primary btn-lg">Sign Up Now</button>
				</div>


            <!-- Links -->
            <div class="text-center mt-3">
              <p class="small mb-1">Already have an account? <a href="{% url 'Authentication:login' %}" class="fw-semibold text-decoration-none">Log in</a></p>
              <a href="{% url 'Authentication:home' %}" class="small text-decoration-none">← Back to Home</a>
            </div>
          </form>

        </div>
      </main>

      <div class="mt-3 text-center small text-muted">Secure registration • We will never share your number</div>
    </div>
  </div>

  {% include "footer.html" %}
</div>

<!-- Inline JS: show/hide password and client validation -->
<script>
(function () {
  // show/hide password (works for both fields)
  const toggle = document.getElementById('passwordToggle');
  const pwd = document.getElementById('id_password');
  const pwd2 = document.getElementById('id_confirm_password');

  if (toggle && pwd) {
    toggle.addEventListener('click', function () {
      if (pwd.type === 'password') {
        pwd.type = 'text';
        if (pwd2) pwd2.type = 'text';
        toggle.innerHTML = '<i class="fas fa-eye-slash"></i>';
        toggle.setAttribute('aria-label','Hide password');
      } else {
        pwd.type = 'password';
        if (pwd2) pwd2.type = 'password';
        toggle.innerHTML = '<i class="fas fa-eye"></i>';
        toggle.setAttribute('aria-label','Show password');
      }
    });
  }

  // Client-side validation: check confirm password match
  const form = document.querySelector('.needs-validation');
  if (form) {
    form.addEventListener('submit', function (event) {
      // basic HTML5 check
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
        form.classList.add('was-validated');
        return;
      }

      // confirm password
      if (pwd && pwd2 && (pwd.value !== pwd2.value)) {
        event.preventDefault();
        event.stopPropagation();
        // show inline error
        let err = document.getElementById('formErrors');
        if (err) {
          err.innerHTML = '<div class="text-danger small">Passwords do not match.</div>';
        }
        form.classList.add('was-validated');
        pwd2.focus();
        return;
      }
    }, false);
  }
})();
</script>

{% endblock 'content' %}
